<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Granpa Reads To Me</title>

    <style>

      .responsive {
        width: 100%;
        height: auto;
      }

      .flip-book {
         box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.5);
         display: none;
         background-size: cover;
      }
       .page {
         padding: 20px;
         background-color: #fdfaf7;
         color: #785e3a;
         border: solid 1px #c2b5a3;
         overflow: hidden;
      }
       .page .page-content {
         width: 100%;
         height: 100%;
         display: flex;
         flex-direction: column;
         justify-content: space-between;
         align-items: stretch;
      }
       .page .page-content .page-header {
         height: 30px;
         font-size: 100%;
         text-transform: uppercase;
         text-align: center;
      }
       .page .page-content .page-image {
         height: 100%;
         background-size: contain;
         background-position: center center;
         background-repeat: no-repeat;
      }
       .page .page-content .page-text {
         height: 100%;
         flex-grow: 1;
         font-size: 80%;
         text-align: justify;
         margin-top: 10px;
         padding-top: 10px;
         box-sizing: border-box;
         border-top: solid 1px #f4e8d7;
      }
       .page .page-content .page-footer {
         height: 30px;
         border-top: solid 1px #f4e8d7;
         font-size: 80%;
         color: #998466;
      }
       .page.--left {
         border-right: 0;
         box-shadow: inset -7px 0 30px -7px rgba(0, 0, 0, 0.4);
      }
       .page.--right {
         border-left: 0;
         box-shadow: inset 7px 0 30px -7px rgba(0, 0, 0, 0.4);
      }
       .page.--right .page-footer {
         text-align: right;
      }
       .page.hard {
         background-color: #f2e8d9;
         border: solid 1px #998466;
      }
       .page.page-cover {
         background-color: #e3d0b5;
         color: #785e3a;
         border: solid 1px #998466;
      }
       .page.page-cover h2 {
         text-align: center;
         padding-top: 50%;
         font-size: 210%;
      }
       .page.page-cover.page-cover-top {
         box-shadow: inset 0px 0 30px 0px rgba(36, 10, 3, 0.5), -2px 0 5px 2px rgba(0, 0, 0, 0.4);
      }
       .page.page-cover.page-cover-bottom {
         box-shadow: inset 0px 0 30px 0px rgba(36, 10, 3, 0.5), 10px 0 8px 0px rgba(0, 0, 0, 0.4);
      }
       .tiny {
         font-size: 50%;
      }

      .btn-prev {
        margin-top: 30px;
        margin-bottom: 10px;
        margin-right: 15px;
        margin-left: 30px;
      }

      .btn-next {
        margin-top: 30px;
        margin-bottom: 10px;
        margin-left: 15px;
      }

      .button {
        width: 60px;
      }

      .controls {
        visibility: hidden;
        opacity: 0.5;
        width: 400px;
        border-radius: 10px;
        position: absolute;
        bottom: 20px;
        left: 50%;
        margin-left: -200px;
        background-color: black;
        box-shadow: 3px 3px 5px black;
        transition: 1s all;
        display: flex;
      }
    </style>

  </head>
  <body>

    <script src="./page-flip.browser.js"></script>


    <button class="play" data-icon="P" aria-label="play pause toggle">Play</button>
    <div class="player">
      <audio controls>
        <!-- <source src="aud/test.mp3" type="audio/mpeg"> -->
        <source src="aud/bell.mp3" type="audio/mpeg">
      </audio>

      <div class="controls">

        <!-- <button class="stop" data-icon="S" aria-label="stop"></button>
        <div class="timer">
          <div></div>
          <span aria-label="timer">00:00</span>
        </div>
        <button class="rwd" data-icon="B" aria-label="rewind"></button>
        <button class="fwd" data-icon="F" aria-label="fast forward"></button> -->

      </div>

    </div>

<!--       <video controls>
        <source src="aud/test.mp3" type="audio/mp3">
        <p>Your browser doesn't support HTML5 video. Here is a <a href="rabbit320.mp4">link to the video</a> instead.</p>
      </video> -->

    <div class="container">
        <div>
            <button type="button" class="btn-prev">
              <img src="img/Previous.jpg" alt="Previous Page" class="button"/>
            </button>
            <button type="button" class="btn-next">
              <img src="img/Next.jpg" alt="Next Page" class="button"/>
            </button>
        </div>
    </div>

    <div class="container">
        <div class="tiny">
            [<span class="page-current">1</span> of <span class="page-total">-</span>]
            State: <i class="page-state">read</i>, orientation: <i class="page-orientation">landscape</i>
        </div>
    </div>

    <div class="container">
      <div id="book">
           <div class="my-page" data-density="hard">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/FrontCover.jpg" alt="FrontCover" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page" data-density="hard">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/InsideFrontCover.jpg" alt="InsideFrontCover" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Frontispiece.jpg" alt="Frontispiece" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/FrontispieceBack.jpg" alt="FrontispieceBack" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/TitlePage.jpg" alt="TitlePage" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page002.jpg" alt="Page002" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page003.jpg" alt="Page003" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page004.jpg" alt="Page004" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page005.jpg" alt="Page005" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page006.jpg" alt="Page006" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page007.jpg" alt="Page007" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page008.jpg" alt="Page008" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page009.jpg" alt="Page009" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page010.jpg" alt="Page010" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page011.jpg" alt="Page011" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page012.jpg" alt="Page012" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page013.jpg" alt="Page013" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page014.jpg" alt="Page014" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page015.jpg" alt="Page015" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page016.jpg" alt="Page016" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page017.jpg" alt="Page017" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page018.jpg" alt="Page018" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page019.jpg" alt="Page019" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page020.jpg" alt="Page020" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page021.jpg" alt="Page021" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page022.jpg" alt="Page022" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page023.jpg" alt="Page023" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page024.jpg" alt="Page024" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page025.jpg" alt="Page025" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page026.jpg" alt="Page026" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page027.jpg" alt="Page027" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page028.jpg" alt="Page028" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page029.jpg" alt="Page029" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page030.jpg" alt="Page030" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page031.jpg" alt="Page031" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page032.jpg" alt="Page032" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Page033.jpg" alt="Page033" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/Rear.jpg" alt="Rear" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page" data-density="hard">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/InsideBackCover.jpg" alt="InsideBackCover" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page" data-density="hard">
              <div class="page-content">
                  <div class="page-image">
                    <img src="img/BackCover.jpg" alt="BackCover" class="responsive">
                  </div>
              </div>
          </div>
          <div class="my-page">
          </div>
          <div class="my-page">
          </div>
          <div class="my-page" data-density="hard">
          </div>
      </div>
    </div>


    <script>

      const portraitTracks = new Array();

      portraitTracks[0] = "aud/test.mp3";
      portraitTracks[1] = "aud/bell.mp3";

      const landscapeTracks = new Array();

      landscapeTracks[0] = "aud/test.mp3";
      landscapeTracks[1] = "aud/bell.mp3";

      document.addEventListener('DOMContentLoaded', function() {
          console.log("All loaded")
          let lastState = 'read';
          // const pageFlip = new PageFlip(
          const pageFlip = new St.PageFlip(
              document.getElementById("book"),
              {
                  width: 550, // base page width
                  height: 733, // base page height

                  // size: "stretch",
                  // set threshold values:
                  minWidth: 315,
                  maxWidth: 1000,
                  minHeight: 420,
                  maxHeight: 1350,

                  maxShadowOpacity: 0.5, // Half shadow intensity
                  showCover: true,
                  mobileScrollSupport: false // disable content scrolling on mobile devices
              }
          );

          // load pages
          pageFlip.loadFromHTML(document.querySelectorAll(".my-page"));

          document.querySelector(".page-total").innerText = pageFlip.getPageCount();
          document.querySelector(
              ".page-orientation"
          ).innerText = pageFlip.getOrientation();

          document.querySelector(".btn-prev").addEventListener("click", () => {
              pageFlip.flipPrev(); // Turn to the previous page (with animation)
          });

          document.querySelector(".btn-next").addEventListener("click", () => {
              pageFlip.flipNext(); // Turn to the next page (with animation)
          });

          // triggered by page turning
          pageFlip.on("flip", (e) => {
              document.querySelector(".page-current").innerText = e.data + 1;
          });

          // triggered when the state of the book changes
          pageFlip.on("changeState", (e) => {
            const state = e.data;
            document.querySelector(".page-state").innerText = state;
            console.log(`State changed: ${state}`)
            if (state === 'read' && ['flipping','user_fold'].includes(lastState)){
              const pageNumber = pageFlip.getCurrentPageIndex();
              console.log(`New page : ${pageNumber + 1}`);
              playPauseMedia(portraitTracks[1]);
            }
            lastState = state;
          });

          // triggered when page orientation changes
          pageFlip.on("changeOrientation", (e) => {
              document.querySelector(".page-orientation").innerText = e.data;
          });
      });

    </script>

    <script src="./custom-player.js"></script>
  </body>
</html>


